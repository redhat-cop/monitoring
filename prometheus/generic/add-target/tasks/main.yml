---
- name: create node_targets directory
  file:
    path: "/home/{{ ansible_user }}/targets/node_targets"
    state: directory
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  when: "'prometheus_target' in groups"

- name: template the node_targets
  template:
    src: node_target.yml.j2
    dest: "/home/{{ ansible_user }}/targets/node_targets/node_target_{{ item }}.yml"
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  loop: "{{ groups['prometheus_target'] }}"
  when: "'prometheus_target' in groups"


- name: create haproxy_targets directory
  file:
    path: "/home/{{ ansible_user }}/targets/haproxy_targets"
    state: directory
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  when: "'prometheus_target_haproxy' in groups"

- name: template the haproxy_targets
  template:
    src: haproxy_target.yml.j2
    dest: "/home/{{ ansible_user }}/targets/haproxy_targets/haproxy_target_{{ item }}.yml"
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  loop: "{{ groups['prometheus_target_haproxy'] }}"
  when: "'prometheus_target_haproxy' in groups"


- name: create bind_targets directory
  file:
    path: "/home/{{ ansible_user }}/targets/bind_targets"
    state: directory
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  when: "'prometheus_target_bind' in groups"

- name: template the bind_targets
  template:
    src: bind_target.yml.j2
    dest: "/home/{{ ansible_user }}/targets/bind_targets/bind_target_{{ item }}.yml"
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  loop: "{{ groups['prometheus_target_bind'] }}"
  when: "'prometheus_target_bind' in groups"

- name: create ssl_targets directory
  file:
    path: "/home/{{ ansible_user }}/targets/ssl_targets"
    state: directory
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  when: "'prometheus_target_ssl' in groups"

- name: template the ssl_targets
  template:
    src: ssl_target.yml.j2
    dest: "/home/{{ ansible_user }}/targets/ssl_targets/ssl_target_{{ item }}.yml"
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  loop: "{{ groups['prometheus_target_ssl'] }}"
  when: "'prometheus_target_ssl' in groups"

- name: create federated_prometheus_targets directory
  file:
    path: "/home/{{ ansible_user }}/targets/prometheus_targets"
    state: directory
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  when: "'prometheus_target_prometheus' in groups"

- name: template the federated_targets
  template:
    src: prometheus_target.yml.j2
    dest: /home/{{ ansible_user }}/targets/prometheus_targets/federated_prometheus_{{ item }}.yml"
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    seuser: system_u
    setype: container_file_t
  loop: "{{ groups['prometheus_target_prometheus'] }}"
  when: "'prometheus_target_prometheus' in groups"
